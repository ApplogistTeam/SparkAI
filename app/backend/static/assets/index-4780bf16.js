import{bD as ee,bE as e,bF as gt,bG as ke,bH as mt,bI as xt,r as l,bJ as qe,bK as _t,bL as ft,bM as yt,bN as Ct,bO as St,bP as vt,bQ as bt,bR as jt,bS as Tt,bT as kt,bU as wt,bV as we,bW as Nt}from"./vendor-7810ac01.js";import{D as Be,S as C,I as Ne,P as Lt,T as ue,a as At,B as ge,b as It,c as ie,d as $e,C as Pt,e as Le,L as Et,f as Rt,g as Mt,h as Ae,i as Gt,j as qt,k as Bt,l as R,m as $t,n as Ft}from"./fluentui-react-63b3d3f8.js";import{e as Ot,E as Ut,f as Ht,g as Vt,D as Dt,h as Qt}from"./fluentui-icons-e67e11a4.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const a of d.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(o){if(o.ep)return;o.ep=!0;const d=n(o);fetch(o.href,d)}})();const zt=".auth/me",Kt=".auth/refresh",Wt=".auth/logout?post_logout_redirect_uri=/";async function Jt(){const t=await fetch("/auth_setup");if(!t.ok)throw new Error(`auth setup response was not ok: ${t.status}`);return await t.json()}const F=await Jt(),M=F.useLogin,D=F.requireAccessControl,Xt=F.msalConfig,Yt=F.loginRequest,Zt=F.tokenRequest,Fe=()=>window.location.origin+F.msalConfig.auth.redirectUri,es=()=>fetch(Kt).then(t=>t.ok?fetch(zt).then(s=>s.ok?s.json().then(n=>n.length>0?{id_token:n[0].id_token,access_token:n[0].access_token,user_claims:n[0].user_claims.reduce((c,o)=>(c[o.typ]=o.val,c),{})}:null):null):null),G=await es(),ts=()=>{window.location.href=Wt},de=t=>t?.getActiveAccount()!=null||G!=null,Ie=t=>G?Promise.resolve(G.access_token):t.acquireTokenSilent({...Zt,redirectUri:Fe()}).then(s=>s.accessToken).catch(s=>{console.log(s)});const ss="/assets/github-fab00c2d.svg",ns="_layout_1nrkm_1",os="_header_1nrkm_7",as="_headerContainer_1nrkm_12",rs="_headerTitleContainer_1nrkm_20",is="_headerLogo_1nrkm_28",cs="_headerTitle_1nrkm_20",ls="_headerNavList_1nrkm_37",us="_headerNavPageLink_1nrkm_43",ds="_headerNavPageLinkActive_1nrkm_57",hs="_headerNavLeftMargin_1nrkm_62",ps="_headerRightText_1nrkm_66",gs="_microsoftLogo_1nrkm_71",ms="_githubLogo_1nrkm_76",S={layout:ns,header:os,headerContainer:as,headerTitleContainer:rs,headerLogo:is,headerTitle:cs,headerNavList:ls,headerNavPageLink:us,headerNavPageLinkActive:ds,headerNavLeftMargin:hs,headerRightText:ps,microsoftLogo:gs,githubLogo:ms},xs="_loginButton_m8yze_1",_s={loginButton:xs},fs=()=>{const{instance:t}=ee(),s=t.getActiveAccount(),n=(s||G)!=null,c=()=>{t.loginPopup({...Yt,redirectUri:Fe()}).catch(a=>console.log(a))},o=()=>{s?t.logoutPopup({mainWindowRedirectUri:"/",account:t.getActiveAccount()}).catch(a=>console.log(a)):ts()},d=`Logout
${s?.username??G?.user_claims?.preferred_username}`;return e.jsx(Be,{text:n?d:"Login",className:_s.loginButton,onClick:n?o:c})},Pe=()=>e.jsxs("div",{className:S.layout,children:[e.jsx("header",{className:S.header,role:"banner",children:e.jsxs("div",{className:S.headerContainer,children:[e.jsx(gt,{to:"/",className:S.headerTitleContainer,children:e.jsx("h3",{className:S.headerTitle,children:"Spark AI Enterprise Assistant | by MK"})}),e.jsx("nav",{children:e.jsxs("ul",{className:S.headerNavList,children:[e.jsx("li",{children:e.jsx(ke,{to:"/",className:({isActive:t})=>t?S.headerNavPageLinkActive:S.headerNavPageLink,children:"Chat"})}),e.jsx("li",{className:S.headerNavLeftMargin,children:e.jsx(ke,{to:"/qa",className:({isActive:t})=>t?S.headerNavPageLinkActive:S.headerNavPageLink,children:"Ask a question"})}),e.jsx("li",{className:S.headerNavLeftMargin,children:e.jsx("a",{href:"https://aka.ms/entgptsearch",target:"_blank",title:"Github repository link",children:e.jsx("img",{src:ss,alt:"Github logo","aria-label":"Link to github repository",width:"20px",height:"20px",className:S.githubLogo})})})]})}),e.jsx("h4",{className:S.headerRightText,children:"Azure OpenAI + AI Search"}),M&&e.jsx(fs,{})]})}),e.jsx(mt,{})]}),ys="_container_18ti9_1",Cs="_chatRoot_18ti9_8",Ss="_chatContainer_18ti9_13",vs="_chatEmptyState_18ti9_21",bs="_chatEmptyStateTitle_18ti9_31",js="_chatEmptyStateSubtitle_18ti9_38",Ts="_chatMessageStream_18ti9_54",ks="_chatMessageGpt_18ti9_66",ws="_chatMessageGptMinWidth_18ti9_73",Ns="_chatInput_18ti9_78",Ls="_chatAnalysisPanel_18ti9_91",As="_chatSettingsSeparator_18ti9_99",Is="_loadingLogo_18ti9_103",Ps="_commandsContainer_18ti9_107",Es="_commandButton_18ti9_112",p={container:ys,chatRoot:Cs,chatContainer:Ss,chatEmptyState:vs,chatEmptyStateTitle:bs,chatEmptyStateSubtitle:js,chatMessageStream:Ts,chatMessageGpt:ks,chatMessageGptMinWidth:ws,chatInput:Ns,chatAnalysisPanel:Ls,chatSettingsSeparator:As,loadingLogo:Is,commandsContainer:Ps,commandButton:Es},te="";function me(t){var s={"Content-Type":"application/json"};return M&&G==null&&t&&(s.Authorization=`Bearer ${t}`),s}async function zn(t,s){const n=await fetch(`${te}/ask`,{method:"POST",headers:me(s),body:JSON.stringify(t)}),c=await n.json();if(n.status>299||!n.ok)throw Error(c.error||"Unknown error");return c}async function Rs(t){return await(await fetch(`${te}/config`,{method:"GET",headers:me(t)})).json()}async function Ms(t,s){return await fetch(`${te}/chat`,{method:"POST",headers:me(s),body:JSON.stringify(t)})}function Oe(t){return`${te}/content/${t}`}var b=(t=>(t.Hybrid="hybrid",t.Vectors="vectors",t.Text="text",t))(b||{}),I=(t=>(t.TextAndImages="textAndImages",t.Images="images",t.Texts="texts",t))(I||{}),w=(t=>(t.Embedding="embedding",t.ImageEmbedding="imageEmbedding",t.Both="both",t))(w||{});const Gs="_answerContainer_1sqax_1",qs="_answerLogo_1sqax_11",Bs="_answerText_1sqax_15",$s="_selected_1sqax_34",Fs="_citationLearnMore_1sqax_38",Os="_citation_1sqax_38",Us="_followupQuestionsList_1sqax_60",Hs="_followupQuestionLearnMore_1sqax_64",Vs="_followupQuestion_1sqax_60",Ds="_supContainer_1sqax_83",Qs="_retryButton_1sqax_112",zs="_loadingdots_1sqax_134",Ks="_loading_1sqax_134",v={answerContainer:Gs,answerLogo:qs,answerText:Bs,selected:$s,citationLearnMore:Fs,citation:Os,followupQuestionsList:Us,followupQuestionLearnMore:Hs,followupQuestion:Vs,supContainer:Ds,retryButton:Qs,loadingdots:zs,loading:Ks};function Ws(t,s,n){const c=[];let o=t.trim();if(s){let u=o.length;for(let g=o.length-1;g>=0&&o[g]!=="]";g--)if(o[g]==="["){u=g;break}o=o.substring(0,u)}return{answerHtml:o.split(/\[([^\]]+)\]/g).map((u,m)=>{if(m%2===0)return u;{let g;c.indexOf(u)!==-1?g=c.indexOf(u)+1:(c.push(u),g=c.length);const h=Oe(u);return xt(e.jsx("a",{className:"supContainer",title:u,onClick:()=>n(h),children:e.jsx("sup",{children:g})}))}}).join(""),citations:c}}const Ue=()=>e.jsx(Ot,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),Ee=({answer:t,isSelected:s,isStreaming:n,onCitationClicked:c,onThoughtProcessClicked:o,onSupportingContentClicked:d,onFollowupQuestionClicked:a,showFollowupQuestions:u})=>{const m=t.choices[0].context.followup_questions,g=t.choices[0].message.content,h=l.useMemo(()=>Ws(g,n,c),[t]),x=qe.sanitize(h.answerHtml);return e.jsxs(C,{className:`${v.answerContainer} ${s&&v.selected}`,verticalAlign:"space-between",children:[e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,horizontalAlign:"space-between",children:[e.jsx(Ue,{}),e.jsxs("div",{children:[e.jsx(Ne,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>o(),disabled:!t.choices[0].context.thoughts?.length}),e.jsx(Ne,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>d(),disabled:!t.choices[0].context.data_points})]})]})}),e.jsx(C.Item,{grow:!0,children:e.jsx("div",{className:v.answerText,dangerouslySetInnerHTML:{__html:x}})}),!!h.citations.length&&e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e.jsx("span",{className:v.citationLearnMore,children:"Citations:"}),h.citations.map((f,T)=>{const A=Oe(f);return e.jsx("a",{className:v.citation,title:f,onClick:()=>c(A),children:`${++T}. ${f}`},T)})]})}),!!m?.length&&u&&a&&e.jsx(C.Item,{children:e.jsxs(C,{horizontal:!0,wrap:!0,className:`${h.citations.length?v.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e.jsx("span",{className:v.followupQuestionLearnMore,children:"Follow-up questions:"}),m.map((f,T)=>e.jsx("a",{className:v.followupQuestion,title:f,onClick:()=>a(f),children:`${f}`},T))]})})]})},Js=()=>{const t=_t({from:{opacity:0},to:{opacity:1}});return e.jsx(ft.div,{style:{...t},children:e.jsxs(C,{className:v.answerContainer,verticalAlign:"space-between",children:[e.jsx(Ue,{}),e.jsx(C.Item,{grow:!0,children:e.jsxs("p",{className:v.answerText,children:["Generating answer",e.jsx("span",{className:v.loadingdots})]})})]})})},Xs=({error:t,onRetry:s})=>e.jsxs(C,{className:v.answerContainer,verticalAlign:"space-between",children:[e.jsx(Ut,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e.jsx(C.Item,{grow:!0,children:e.jsx("p",{className:v.answerText,children:t})}),e.jsx(Lt,{className:v.retryButton,onClick:s,text:"Retry"})]}),Ys="_questionInputContainer_hiipw_1",Zs="_questionInputTextArea_hiipw_12",en="_questionInputButtonsContainer_hiipw_17",ce={questionInputContainer:Ys,questionInputTextArea:Zs,questionInputButtonsContainer:en},tn=({onSend:t,disabled:s,placeholder:n,clearOnSend:c,initQuestion:o})=>{const[d,a]=l.useState("");l.useEffect(()=>{o&&a(o)},[o]);const u=()=>{s||!d.trim()||(t(d),c&&a(""))},m=T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),u())},g=(T,A)=>{A?A.length<=1e3&&a(A):a("")},{instance:h}=ee(),x=D&&!de(h),f=s||!d.trim()||x;return x&&(n="Please login to continue..."),e.jsxs(C,{horizontal:!0,className:ce.questionInputContainer,children:[e.jsx(ue,{className:ce.questionInputTextArea,disabled:x,placeholder:n,multiline:!0,resizable:!1,borderless:!0,value:d,onChange:g,onKeyDown:m}),e.jsx("div",{className:ce.questionInputButtonsContainer,children:e.jsx(At,{content:"Ask question button",relationship:"label",children:e.jsx(ge,{size:"large",icon:e.jsx(Ht,{primaryFill:"rgba(115, 118, 225, 1)"}),disabled:f,onClick:u})})})]})},sn="_examplesNavList_o3hyg_1",nn="_example_o3hyg_1",on="_exampleText_o3hyg_29",he={examplesNavList:sn,example:nn,exampleText:on},an=({text:t,value:s,onClick:n})=>e.jsx("div",{className:he.example,onClick:()=>n(s),children:e.jsx("p",{className:he.exampleText,children:t})}),rn=["What is included in my Northwind Health Plus plan that is not in standard?","What happens in a performance review?","What does a Product Manager do?"],cn=["Compare the impact of interest rates and GDP in financial markets.","What is the expected trend for the S&P 500 index over the next five years? Compare it to the past S&P 500 performance","Can you identify any correlation between oil prices and stock market trends?"],ln=({onExampleClicked:t,useGPT4V:s})=>e.jsx("ul",{className:he.examplesNavList,children:(s?cn:rn).map((n,c)=>e.jsx("li",{children:e.jsx(an,{text:n,value:n,onClick:t})},c))}),un="_container_1p3pb_1",dn="_message_1p3pb_9",Re={container:un,message:dn},Z=({message:t})=>e.jsx("div",{className:Re.container,children:e.jsx("div",{className:Re.message,children:t})}),hn="_thoughtProcess_1nmyh_1",pn="_tList_1nmyh_8",gn="_tListItem_1nmyh_14",mn="_tStep_1nmyh_40",xn="_tCodeBlock_1nmyh_46",_n="_tProp_1nmyh_50",fn="_citationImg_1nmyh_58",$={thoughtProcess:hn,tList:pn,tListItem:gn,tStep:mn,tCodeBlock:xn,tProp:_n,citationImg:fn};function yn(t){const s=t.split(": "),n=s[0],c=qe.sanitize(s.slice(1).join(": "));return{title:n,content:c}}const Cn="_supportingContentNavList_beb5d_1",Sn="_supportingContentItem_beb5d_9",vn="_supportingContentItemHeader_beb5d_23",bn="_supportingContentItemText_beb5d_27",jn="_supportingContentItemImage_beb5d_32",Q={supportingContentNavList:Cn,supportingContentItem:Sn,supportingContentItemHeader:vn,supportingContentItemText:bn,supportingContentItemImage:jn},Tn=({supportingContent:t})=>{const s=Array.isArray(t)?t:t.text,n=Array.isArray(t)?[]:t?.images;return e.jsxs("ul",{className:Q.supportingContentNavList,children:[s.map(c=>{const o=yn(c);return e.jsx(kn,{...o})}),n?.map(c=>e.jsx("img",{className:Q.supportingContentItemImage,src:c.url}))]})},kn=({title:t,content:s})=>e.jsxs("li",{className:Q.supportingContentItem,children:[e.jsx("h4",{className:Q.supportingContentItemHeader,children:t}),e.jsx("p",{className:Q.supportingContentItemText,dangerouslySetInnerHTML:{__html:s}})]});var N=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(N||{});const wn=({thoughts:t})=>e.jsx("ul",{className:$.tList,children:t.map(s=>e.jsxs("li",{className:$.tListItem,children:[e.jsx("div",{className:$.tStep,children:s.title}),Array.isArray(s.description)?e.jsx(yt,{language:"json",wrapLongLines:!0,className:$.tCodeBlock,children:JSON.stringify(s.description,null,2)}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.description}),e.jsx(C,{horizontal:!0,tokens:{childrenGap:5},children:s.props&&(Object.keys(s.props)||[]).map(n=>e.jsxs("span",{className:$.tProp,children:[n,": ",JSON.stringify(s.props?.[n])]}))})]})]}))}),le={disabled:!0,style:{color:"grey"}},Nn=({answer:t,activeTab:s,activeCitation:n,citationHeight:c,className:o,onActiveTabChanged:d})=>{const a=!t.choices[0].context.thoughts,u=!t.choices[0].context.data_points,m=!n;return e.jsxs(It,{className:o,selectedKey:s,onLinkClick:g=>g&&d(g.props.itemKey),children:[e.jsx(ie,{itemKey:N.ThoughtProcessTab,headerText:"Thought process",headerButtonProps:a?le:void 0,children:e.jsx(wn,{thoughts:t.choices[0].context.thoughts||[]})}),e.jsx(ie,{itemKey:N.SupportingContentTab,headerText:"Supporting content",headerButtonProps:u?le:void 0,children:e.jsx(Tn,{supportingContent:t.choices[0].context.data_points})}),e.jsx(ie,{itemKey:N.CitationTab,headerText:"Citation",headerButtonProps:m?le:void 0,children:n?.endsWith(".png")?e.jsx("img",{src:n,className:$.citationImg}):e.jsx("iframe",{title:"Citation",src:n,width:"100%",height:c})})]})},Ln="_container_cfwv2_1",An={container:Ln},In=({className:t,onClick:s})=>e.jsx("div",{className:`${An.container} ${t??""}`,children:e.jsx(ge,{icon:e.jsx(Vt,{}),onClick:s,children:"Developer settings"})}),Pn="_container_cfwv2_1",En={container:Pn},Rn=({className:t,disabled:s,onClick:n})=>e.jsx("div",{className:`${En.container} ${t??""}`,children:e.jsx(ge,{icon:e.jsx(Dt,{}),disabled:s,onClick:n,children:"Clear chat"})}),Mn="_container_1pzrp_1",Me={container:Mn},Gn=[{key:w.Embedding,text:"Text Embeddings"},{key:w.ImageEmbedding,text:"Image Embeddings"},{key:w.Both,text:"Text and Image embeddings"}],qn=({updateRetrievalMode:t,updateVectorFields:s,showImageOptions:n})=>{const[c,o]=l.useState(b.Hybrid),[d,a]=l.useState(),u=(g,h)=>{o(h?.data||b.Hybrid),t(h?.data||b.Hybrid)},m=(g,h)=>{h&&a(h.key);let x;h?.key==="both"?x=[w.Embedding,w.ImageEmbedding]:x=[h?.key],s(x)};return l.useEffect(()=>{s(n?[w.Embedding,w.ImageEmbedding]:[w.Embedding])},[n]),e.jsxs(C,{className:Me.container,tokens:{childrenGap:10},children:[e.jsx($e,{className:Me.oneshotSettingsSeparator,label:"Retrieval mode",options:[{key:"hybrid",text:"Vectors + Text (Hybrid)",selected:c==b.Hybrid,data:b.Hybrid},{key:"vectors",text:"Vectors",selected:c==b.Vectors,data:b.Vectors},{key:"text",text:"Text",selected:c==b.Text,data:b.Text}],required:!0,onChange:u}),n&&[b.Vectors,b.Hybrid].includes(c)&&e.jsx(Pt,{options:Gn,onChange:m,selectedKey:d,defaultSelectedKey:w.Both,label:"Vector Fields (Multi-query vector search)"})]})},Bn=()=>{const{instance:t}=ee(),s=t.getActiveAccount(),n=a=>typeof a=="string"?a:JSON.stringify(a),o=(a=>Object.keys(a??{}).map(u=>{let m=u;try{const h=new URL(u).pathname.split("/");u=h[h.length-1]}catch{}return{name:u,value:n((a??{})[m])}}))(s?.idTokenClaims??G?.user_claims),d=[Le({columnId:"name",compare:(a,u)=>a.name.localeCompare(u.name),renderHeaderCell:()=>"Name",renderCell:a=>a.name}),Le({columnId:"value",compare:(a,u)=>a.value.localeCompare(u.value),renderHeaderCell:()=>"Value",renderCell:a=>a.value})];return e.jsxs("div",{children:[e.jsx(Et,{children:"ID Token Claims"}),e.jsxs(Rt,{items:o,columns:d,sortable:!0,getRowId:a=>a.name,children:[e.jsx(Mt,{children:e.jsx(Ae,{children:({renderHeaderCell:a})=>e.jsx(Gt,{children:a()})})}),e.jsx(qt,{children:({item:a,rowId:u})=>e.jsx(Ae,{children:({renderCell:m})=>e.jsx(Bt,{children:m(a)})},u)})]})]})},$n="_container_1pzrp_1",Ge={container:$n},Fn=({updateGPT4VInputs:t,updateUseGPT4V:s,isUseGPT4V:n,gpt4vInputs:c})=>{const[o,d]=l.useState(n),[a,u]=l.useState(c||I.TextAndImages),m=(h,x)=>{s(!!x),d(!!x)},g=(h,x)=>{if(x){const f=x.key;t(f||I.TextAndImages),f&&u(f)}};return l.useEffect(()=>{o&&t(I.TextAndImages)},[o]),e.jsxs(C,{className:Ge.container,tokens:{childrenGap:10},children:[e.jsx(R,{checked:o,label:"Use GPT-4 Turbo with Vision",onChange:m}),o&&e.jsx($e,{selectedKey:a,className:Ge.oneshotSettingsSeparator,label:"GPT-4 Turbo with Vision Inputs",options:[{key:I.TextAndImages,text:"Images and text from index"},{text:"Images only",key:I.Images},{text:"Text only",key:I.Texts}],required:!0,onChange:g})]})},On=()=>{const[t,s]=l.useState(!1),[n,c]=l.useState(""),[o,d]=l.useState(3),[a,u]=l.useState(b.Hybrid),[m,g]=l.useState(!0),[h,x]=l.useState(!0),[f,T]=l.useState(!1),[A,He]=l.useState(""),[z,Ve]=l.useState(!1),[De,Qe]=l.useState([w.Embedding]),[xe,ze]=l.useState(!1),[_e,Ke]=l.useState(!1),[fe,We]=l.useState(I.TextAndImages),[K,Je]=l.useState(!1),P=l.useRef(""),se=l.useRef(null),[W,J]=l.useState(!1),[ye,ne]=l.useState(!1),[X,oe]=l.useState(),[Ce,ae]=l.useState(),[O,q]=l.useState(void 0),[U,Se]=l.useState(0),[j,Y]=l.useState([]),[ve,be]=l.useState([]),[je,Xe]=l.useState(!1),Ye=async()=>{const r=B?await Ie(B):void 0;Rs(r).then(i=>{Xe(i.showGPT4VOptions)})},Ze=async(r,i,k,re)=>{let L="",_={};const dt=y=>new Promise(ht=>{setTimeout(()=>{L+=y;const pt={..._,choices:[{..._.choices[0],message:{content:L,role:_.choices[0].message.role}}]};be([...i,[r,pt]]),ht(null)},33)});try{ne(!0);for await(const y of Ct(re))if(y.choices&&y.choices[0].context&&y.choices[0].context.data_points)y.choices[0].message=y.choices[0].delta,_=y;else if(y.choices&&y.choices[0].delta.content)J(!1),await dt(y.choices[0].delta.content);else if(y.choices&&y.choices[0].context)_.choices[0].context={..._.choices[0].context,...y.choices[0].context};else if(y.error)throw Error(y.error)}finally{ne(!1)}return{..._,choices:[{..._.choices[0],message:{content:L,role:_.choices[0].message.role}}]}},B=M?ee().instance:void 0,H=async r=>{P.current=r,X&&oe(void 0),J(!0),ae(void 0),q(void 0);const i=B?await Ie(B):void 0;try{const re={messages:[...j.flatMap(_=>[{content:_[0],role:"user"},{content:_[1].choices[0].message.content,role:"assistant"}]),{content:r,role:"user"}],stream:h,context:{overrides:{prompt_template:n.length===0?void 0:n,exclude_category:A.length===0?void 0:A,top:o,retrieval_mode:a,semantic_ranker:m,semantic_captions:f,suggest_followup_questions:z,use_oid_security_filter:xe,use_groups_security_filter:_e,vector_fields:De,use_gpt4v:K,gpt4v_input:fe}},session_state:j.length?j[j.length-1][1].choices[0].session_state:null},L=await Ms(re,i);if(!L.body)throw Error("No response body");if(h){const _=await Ze(r,j,Y,L.body);Y([...j,[r,_]])}else{const _=await L.json();if(L.status>299||!L.ok)throw Error(_.error||"Unknown error");Y([...j,[r,_]])}}catch(k){oe(k)}finally{J(!1)}},et=()=>{P.current="",X&&oe(void 0),ae(void 0),q(void 0),Y([]),be([]),J(!1),ne(!1)};l.useEffect(()=>se.current?.scrollIntoView({behavior:"smooth"}),[W]),l.useEffect(()=>se.current?.scrollIntoView({behavior:"auto"}),[ve]),l.useEffect(()=>{Ye()},[]);const tt=(r,i)=>{c(i||"")},st=(r,i)=>{d(parseInt(i||"3"))},nt=(r,i)=>{g(!!i)},ot=(r,i)=>{T(!!i)},at=(r,i)=>{x(!!i)},rt=(r,i)=>{He(i||"")},it=(r,i)=>{Ve(!!i)},ct=(r,i)=>{ze(!!i)},lt=(r,i)=>{Ke(!!i)},ut=r=>{H(r)},Te=(r,i)=>{Ce===r&&O===N.CitationTab&&U===i?q(void 0):(ae(r),q(N.CitationTab)),Se(i)},V=(r,i)=>{q(O===r&&U===i?void 0:r),Se(i)};return e.jsxs("div",{className:p.container,children:[e.jsxs("div",{className:p.commandsContainer,children:[e.jsx(Rn,{className:p.commandButton,onClick:et,disabled:!P.current||W}),e.jsx(In,{className:p.commandButton,onClick:()=>s(!t)})]}),e.jsxs("div",{className:p.chatRoot,children:[e.jsxs("div",{className:p.chatContainer,children:[P.current?e.jsxs("div",{className:p.chatMessageStream,children:[ye&&ve.map((r,i)=>e.jsxs("div",{children:[e.jsx(Z,{message:r[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(Ee,{isStreaming:!0,answer:r[1],isSelected:!1,onCitationClicked:k=>Te(k,i),onThoughtProcessClicked:()=>V(N.ThoughtProcessTab,i),onSupportingContentClicked:()=>V(N.SupportingContentTab,i),onFollowupQuestionClicked:k=>H(k),showFollowupQuestions:z&&j.length-1===i},i)})]},i)),!ye&&j.map((r,i)=>e.jsxs("div",{children:[e.jsx(Z,{message:r[0]}),e.jsx("div",{className:p.chatMessageGpt,children:e.jsx(Ee,{isStreaming:!1,answer:r[1],isSelected:U===i&&O!==void 0,onCitationClicked:k=>Te(k,i),onThoughtProcessClicked:()=>V(N.ThoughtProcessTab,i),onSupportingContentClicked:()=>V(N.SupportingContentTab,i),onFollowupQuestionClicked:k=>H(k),showFollowupQuestions:z&&j.length-1===i},i)})]},i)),W&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{message:P.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(Js,{})})]}),X?e.jsxs(e.Fragment,{children:[e.jsx(Z,{message:P.current}),e.jsx("div",{className:p.chatMessageGptMinWidth,children:e.jsx(Xs,{error:X.toString(),onRetry:()=>H(P.current)})})]}):null,e.jsx("div",{ref:se})]}):e.jsxs("div",{className:p.chatEmptyState,children:[e.jsx(Qt,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e.jsx("h1",{className:p.chatEmptyStateTitle,children:"Chat with your data"}),e.jsx("h2",{className:p.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e.jsx(ln,{onExampleClicked:ut,useGPT4V:K})]}),e.jsx("div",{className:p.chatInput,children:e.jsx(tn,{clearOnSend:!0,placeholder:"Type a new question (e.g. does my plan cover annual eye exams?)",disabled:W,onSend:r=>H(r)})})]}),j.length>0&&O&&e.jsx(Nn,{className:p.chatAnalysisPanel,activeCitation:Ce,onActiveTabChanged:r=>V(r,U),citationHeight:"810px",answer:j[U][1],activeTab:O}),e.jsxs($t,{headerText:"Configure answer generation",isOpen:t,isBlocking:!1,onDismiss:()=>s(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e.jsx(Be,{onClick:()=>s(!1),children:"Close"}),isFooterAtBottom:!0,children:[e.jsx(ue,{className:p.chatSettingsSeparator,defaultValue:n,label:"Override prompt template",multiline:!0,autoAdjustHeight:!0,onChange:tt}),e.jsx(Ft,{className:p.chatSettingsSeparator,label:"Retrieve this many search results:",min:1,max:50,defaultValue:o.toString(),onChange:st}),e.jsx(ue,{className:p.chatSettingsSeparator,label:"Exclude category",onChange:rt}),e.jsx(R,{className:p.chatSettingsSeparator,checked:m,label:"Use semantic ranker for retrieval",onChange:nt}),e.jsx(R,{className:p.chatSettingsSeparator,checked:f,label:"Use query-contextual summaries instead of whole documents",onChange:ot,disabled:!m}),e.jsx(R,{className:p.chatSettingsSeparator,checked:z,label:"Suggest follow-up questions",onChange:it}),je&&e.jsx(Fn,{gpt4vInputs:fe,isUseGPT4V:K,updateUseGPT4V:r=>{Je(r)},updateGPT4VInputs:r=>We(r)}),e.jsx(qn,{showImageOptions:K&&je,updateVectorFields:r=>Qe(r),updateRetrievalMode:r=>u(r)}),M&&e.jsx(R,{className:p.chatSettingsSeparator,checked:xe||D,label:"Use oid security filter",disabled:!de(B)||D,onChange:ct}),M&&e.jsx(R,{className:p.chatSettingsSeparator,checked:_e||D,label:"Use groups security filter",disabled:!de(B)||D,onChange:lt}),e.jsx(R,{className:p.chatSettingsSeparator,checked:h,label:"Stream chat completion responses",onChange:at}),M&&e.jsx(Bn,{})]})]})]})};var pe;if(M){var E=new St(Xt);!E.getActiveAccount()&&E.getAllAccounts().length>0&&E.setActiveAccount(E.getActiveAccount()),E.addEventCallback(t=>{if(t.eventType===vt.LOGIN_SUCCESS&&t.payload){const s=t.payload;E.setActiveAccount(s)}}),pe=e.jsx(Nt,{instance:E,children:e.jsx(Pe,{})})}else pe=e.jsx(Pe,{});bt();const Un=jt([{path:"/",element:pe,children:[{index:!0,element:e.jsx(On,{})},{path:"qa",lazy:()=>we(()=>import("./OneShot-0625e7eb.js"),["assets/OneShot-0625e7eb.js","assets/vendor-7810ac01.js","assets/fluentui-react-63b3d3f8.js","assets/fluentui-icons-e67e11a4.js","assets/OneShot-daa12333.css"])},{path:"*",lazy:()=>we(()=>import("./NoPage-ea4b1efc.js"),["assets/NoPage-ea4b1efc.js","assets/vendor-7810ac01.js"])}]}]);Tt.createRoot(document.getElementById("root")).render(e.jsx(kt.StrictMode,{children:e.jsx(wt,{router:Un})}));export{Ee as A,ln as E,I as G,tn as Q,b as R,In as S,Bn as T,w as V,N as a,Xs as b,Nn as c,Fn as d,qn as e,Rs as f,Ie as g,zn as h,de as i,D as r,M as u};
//# sourceMappingURL=index-4780bf16.js.map
